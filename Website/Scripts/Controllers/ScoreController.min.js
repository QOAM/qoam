var ScoreController=function(){function n(){}return n.prototype.index=function(n,t,i){$("#Title").typeahead({remote:n+"?query=%QUERY"});$("#Issn").typeahead({remote:t+"?query=%QUERY"});$("#Publisher").typeahead({remote:i+"?query=%QUERY"})},n.prototype.details=function(){$('.scoreCardAspects a[data-select-tab="true"]').on("click",function(){return $('#scoreTabs a[href="'+$(this).attr("href")+'"]').tab("show"),!1})},n.prototype.journal=function(n,t,i){var r=null,u=4;$('.scoreCardAspects a[data-select-tab="true"], #OverviewTab a[data-select-tab="true"]').on("click",function(){return $('#scoreTabs a[href="'+$(this).attr("href")+'"]').tab("show"),!1});var f=function(n,t){var r=this,i=ko.utils.arrayFilter(t,function(t){return t.QuestionCategory()==n});r.completed=ko.computed(function(){return ko.utils.arrayFirst(i,function(n){return n.Score()==0})==null});r.partOfBaseScore=function(){return n!=u};r.score=ko.computed(function(){if(i.length==0)return 0;var n=0;return ko.utils.arrayForEach(i,function(t){n+=t.Score()}),Math.round(n/i.length*10)/10})},e=function(n,t){var r=this,i=ko.utils.arrayFirst(t,function(t){return t.QuestionKey()==n});r.score=ko.computed({read:function(){return i.Score()},write:function(n){i.Score(+n)}})},o=function(u){var o=this,h=n?n.Submitted:!1,s,c;o.IsPublishedWithinYear=ko.observable(h);o.IsOutDatedPublication=ko.observable(n.Price.Amount!=null&&n?!h:!1);o.IsOutDatedPublicationArticle=ko.observable(n?o.IsOutDatedPublicationArticle:!1);o.IsOutDatedPublicationPage=ko.observable(n?o.IsOutDatedPublicationPage:!1);o.IsPublishedWithinYearScored=ko.observable(!1);o.IsPublishedWithinYearRadio=ko.computed({read:function(){return n.Submitted},write:function(n){n=="true"?(o.Submitted(!0),o.IsPublishedWithinYear(!0),o.IsOutDatedPublication(!1)):(o.Submitted(!1),o.IsPublishedWithinYear(!1),o.IsOutDatedPublication(!0))}});ko.mapping.fromJS(u,{},o);s=$("#isEditorComment").val();c=ko.utils.arrayGetDistinctValues(ko.utils.arrayMap(o.QuestionScores(),function(n){return n.QuestionCategory()}));o.publishing=ko.observable(!1);o.getRequestVerificationToken=function(){return $('#journalScoreForm input[name="__RequestVerificationToken"]').val()};o.storeScoreCard=function(){return r!=null&&r.abort(),r=$.ajax({type:"POST",url:t,contentType:"application/json",data:ko.utils.stringifyJson(ko.mapping.toJS(o)),dataType:"json",headers:{__RequestVerificationToken:o.getRequestVerificationToken()}})};o.publishScoreCard=function(){o.publishing(!0);o.Publish(!0);o.storeScoreCard().done(function(){$("#publishedModal").modal().on("hide.bs.modal",function(){window.location.href=i})}).fail(function(){alert("Something failed!");o.publishing(!1)})};o.categoryScores=ko.observableArray();o.questionScores=ko.observableArray();o.baseScore=ko.computed(function(){return ko.utils.arrayMap(ko.utils.arrayFilter(o.categoryScores(),function(n){return n.partOfBaseScore()&&n.completed()}),function(n){return n.score()}).sort()[0]||0});o.progress=ko.computed(function(){var n=ko.utils.arrayFilter(o.QuestionScores(),function(n){return n.Score()>0}).length,t=o.QuestionScores().length;return Math.round(n/t*100)});o.progressPercentage=ko.computed(function(){return o.progress()+"%"});o.progressClass=ko.computed(function(){var n=o.progress();return n<50?"progress-bar-danger":n<100?"progress-bar-warning":"progress-bar-success"});ko.utils.arrayForEach(c,function(n){o.categoryScores.push(new f(n,o.QuestionScores()))});ko.utils.arrayForEach(o.QuestionScores(),function(n){o.questionScores.push(new e(n.QuestionKey(),o.QuestionScores()))});o.canPublish=ko.computed(function(){return o.progress()>=100&&!o.publishing()&&o.IsPublishedWithinYearScored});o.onRemarksFocus=function(){$(this).val()==s&&$(this).val("")};o.onRemarksBlur=function(){$(this).val()==""&&$(this).val(s)};o.Editor.subscribe(function(n){var t=$("#remarks");if(n){t.val(s);t.on("focus",o.onRemarksFocus).on("blur",o.onRemarksBlur)}else t.val(""),t.off("focus",o.onRemarksFocus).off("blur",o.onRemarksBlur)});$("input[type=radio][name=IsPublishedWithinYearRadio]").bind("click",function(){var n=$(this).val()=="true";o.Submitted(n);o.IsPublishedWithinYear(n);o.IsOutDatedPublication(!n);o.IsPublishedWithinYearScored(n)});$("input[type=radio][name=outdatedPublication]").bind("click",function(){var n=$(this).val();o.Submitted(!1);o.Price.FeeType=n;o.IsPublishedWithinYearScored(!0);switch(n){case"Article":o.IsOutDatedPublicationArticle(!0);o.IsOutDatedPublicationPage(!1);break;case"Page":o.IsOutDatedPublicationArticle(!1);o.IsOutDatedPublicationPage(!0);break;default:o.IsOutDatedPublicationArticle(!1);o.IsOutDatedPublicationPage(!1)}});(n.Price.Amount!=null||o.progress()>=100)&&($("input[type=radio][name=IsPublishedWithinYearRadio]").each(function(){$(this).val()==n.Submitted.toString()&&$(this).prop("checked",!0)}),$("input[type=radio][name=outdatedPublication]").each(function(t){n.Price.FeeType==t&&($(this).prop("checked",!0),$(this).trigger("click"))}));n.State==0&&(o.questionScoresDirtyFlag=new ko.dirtyFlag(o.questionScores,!1),o.remarksDirtyFlag=new ko.dirtyFlag(o.Remarks,!1),o.editorDirtyFlag=new ko.dirtyFlag(o.Editor,!1),o.submittedDirtyFlag=new ko.dirtyFlag(o.Submitted,!1),o.priceDirtyFlag=new ko.dirtyFlag(o.Price,!1),o.isDirty=ko.computed(function(){return o.questionScoresDirtyFlag.isDirty()||o.remarksDirtyFlag.isDirty()||o.editorDirtyFlag.isDirty()||o.submittedDirtyFlag.isDirty()||o.priceDirtyFlag.isDirty()},o).extend({throttle:2e3}),o.isDirty.subscribe(function(n){n&&!o.publishing()&&(o.Publish(!1),o.storeScoreCard().done(function(){o.questionScoresDirtyFlag.reset(o.questionScores);o.remarksDirtyFlag.reset(o.Remarks);o.editorDirtyFlag.reset(o.Editor);o.submittedDirtyFlag.reset(o.Submitted);o.priceDirtyFlag.reset(o.Price)}))}))},s=new o(n);ko.applyBindings(s)},n}();
/*
//# sourceMappingURL=ScoreController.min.js.map
*/