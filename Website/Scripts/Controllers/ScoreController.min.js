var ScoreController=function(){function n(){}return n.prototype.index=function(n,t,i){$("#Title").typeahead({prefetch:n});$("#Issn").typeahead({prefetch:t});$("#Publisher").typeahead({prefetch:i})},n.prototype.details=function(){$('.scoreCardAspects a[data-select-tab="true"]').on("click",function(){return $('#scoreTabs a[href="'+$(this).attr("href")+'"]').tab("show"),!1})},n.prototype.journal=function(n,t,i){var r=null,u=4;$('.scoreCardAspects a[data-select-tab="true"], #OverviewTab a[data-select-tab="true"]').on("click",function(){return $('#scoreTabs a[href="'+$(this).attr("href")+'"]').tab("show"),!1});var f=function(n,t){var r=this,i=ko.utils.arrayFilter(t,function(t){return t.QuestionCategory()==n});r.completed=ko.computed(function(){return ko.utils.arrayFirst(i,function(n){return n.Score()==0})==null});r.partOfBaseScore=function(){return n!=u};r.score=ko.computed(function(){if(i.length==0)return 0;var n=0;return ko.utils.arrayForEach(i,function(t){n+=t.Score()}),Math.round(n/i.length*10)/10})},e=function(n,t){var r=this,i=ko.utils.arrayFirst(t,function(t){return t.QuestionKey()==n});r.score=ko.computed({read:function(){return i.Score()},write:function(n){i.Score(+n)}})},o=function(n){var u=this,o,s;ko.mapping.fromJS(n,{},u);o=$("#isEditorComment").val();s=ko.utils.arrayGetDistinctValues(ko.utils.arrayMap(u.QuestionScores(),function(n){return n.QuestionCategory()}));u.publishing=ko.observable(!1);u.getRequestVerificationToken=function(){return $('#journalScoreForm input[name="__RequestVerificationToken"]').val()};u.storeScoreCard=function(){r!=null&&r.abort();r=$.ajax({type:"POST",url:t,contentType:"application/json",data:ko.utils.stringifyJson(ko.mapping.toJS(u)),dataType:"json",headers:{__RequestVerificationToken:u.getRequestVerificationToken()}}).done(function(){$("#publishedModal").modal().on("hide.bs.modal",function(){window.location.href=i})}).fail(function(){alert("Something failed!");u.publishing(!1)})};u.publishScoreCard=function(){u.publishing(!0);u.storeScoreCard()};u.categoryScores=ko.observableArray();u.questionScores=ko.observableArray();u.baseScore=ko.computed(function(){return ko.utils.arrayMap(ko.utils.arrayFilter(u.categoryScores(),function(n){return n.partOfBaseScore()&&n.completed()}),function(n){return n.score()}).sort()[0]||0});u.progress=ko.computed(function(){var n=ko.utils.arrayFilter(u.QuestionScores(),function(n){return n.Score()>0}).length,t=u.QuestionScores().length;return Math.round(n/t*100)});u.progressPercentage=ko.computed(function(){return u.progress()+"%"});u.progressClass=ko.computed(function(){var n=u.progress();return n<50?"progress-bar-danger":n<100?"progress-bar-warning":"progress-bar-success"});ko.utils.arrayForEach(s,function(n){u.categoryScores.push(new f(n,u.QuestionScores()))});ko.utils.arrayForEach(u.QuestionScores(),function(n){u.questionScores.push(new e(n.QuestionKey(),u.QuestionScores()))});u.canPublish=ko.computed(function(){return u.progress()>=100&&!u.publishing()});u.onRemarksFocus=function(){$(this).val()==o&&$(this).val("")};u.onRemarksBlur=function(){$(this).val()==""&&$(this).val(o)};u.Editor.subscribe(function(n){var t=$("#remarks");if(n){t.val(o);t.on("focus",u.onRemarksFocus).on("blur",u.onRemarksBlur)}else t.val(""),t.off("focus",u.onRemarksFocus).off("blur",u.onRemarksBlur)})},s=new o(n);ko.applyBindings(s)},n}();
/*
//# sourceMappingURL=ScoreController.min.js.map
*/