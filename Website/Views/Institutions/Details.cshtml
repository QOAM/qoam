@using PagedList.Mvc
@using QOAM.Website.Helpers
@using QOAM.Website.Models
@using QOAM.Website.Resources
@model QOAM.Website.ViewModels.Institutions.DetailsViewModel

@{
    ViewBag.Title = string.Format(ViewStrings.Institutions_Details_Title, Model.Institution.Name);
}

<div class="container main">
    <div class="row">
        <div class="col-md-3">
            <div class="well">
                <h3 class="text-align">@Strings.Institution<img src="~/Content/images/profile.png" alt="@Strings.Institution"></h3>

                <h5>@Model.Institution.Name</h5>

                <div>
                    @Model.ScoreCardStats.NumberOfPublishedScoreCards @ViewStrings.Profile_Details_ScoreCardsPublished
                </div>

                <div>
                    @Model.ScoreCardStats.NumberOfExpiredScoreCards @ViewStrings.Profile_Details_ScoreCardsExpired
                </div>

                <div class="bottommargin">
                    @Model.ScoreCardStats.NumberOfUnpublishedScoreCards @ViewStrings.Profile_Details_ScoreCardsUnfinished
                </div>
            </div>
        </div>

        <div class="col-md-9">


            <div class="row">
                <div class="col-md-9">
                    <h3>@Strings.Profiles: @Model.UserProfiles.TotalItemCount</h3>

                </div>
                <div class="col-md-3 text-right topmargin">
                    <div class="topmargin">@Sorting.UserProfileSortMenu(Model.SortBy, Model.Sort)</div>
                </div>
            </div>

            <div class="row">
                @if (Model.UserProfiles.TotalItemCount > 0)
                {
                    <table class="table table-striped table-bordered">
                        <thead>
                            <tr>
                                <th>@Strings.Name</th>
                                <th>@Strings.RegistrationDate</th>
                                <th>@Strings.NumberOfJSCs</th>
                                <th>@Strings.Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var profile in Model.UserProfiles)
                            {
                                <tr>
                                    <td>@Html.ActionLink(profile.DisplayName, "Details", "Profiles", new { id = profile.Id }, null)</td>
                                    <td>@profile.DateRegistered</td>
                                    <td>@profile.NumberOfScoreCards</td>
                                    <td>
                                        <span class="glyphicon glyphicon-eye-open"></span> @Html.ActionLink(Strings.View, "Details", "Profiles", new { id = profile.Id }, null)
                                    
                                        @if (User.IsInRole(ApplicationRole.Admin))
                                        {
                                            <span class="glyphicon glyphicon-pencil"></span>  @Html.ActionLink(Strings.Edit, "Edit", "Profiles", new { profile.Id, ReturnUrl = Request.Url.ToString() }, null)
                                        }
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>

                    @Html.PagedListPager(Model.UserProfiles, page => Url.Action("Details", new { page, Model.Id, Model.Sort, Model.SortBy }), Html.PagedListRenderOptions())
                }
                else
                {
                    <p>
                        @ViewStrings.Institutions_Details_NoUsers
                    </p>
                }
                
            </div>
        </div>
    </div>
</div>

@section scripts
{
    @Html.Partial("_FormScripts")
}